import doctest
import json
from generate_url import generate_url, make_query


def remove_query_cid(cids: list[int], query_cid: int) -> list[int]:
    """
    Given a list of cids with similar structures to the query_cid based on fastidentity, remove the compound with the same connectivity

    >>> remove_query_cid([962, 961, 24602, 104752, 22247451, 157350, 10129877, 6914120, 123332, 105142, 137349153, 139859, 5460554, 10197601, 16048639, 6914119, 17985087, 21871715, 22146520, 44144404, 57470146, 129631210, 171528, 10214376, 20266850, 57422081, 72499223, 5460604, 12676391, 21338204, 23560202, 57418915, 57634601, 57937911, 58422532, 58609138, 58750500, 58828612, 59045931, 59049839, 59102850, 59367517, 59984341, 78060557, 85595863, 85602483, 139617572, 157621312, 158956564, 160528969, 161115002, 163575618, 139505, 12161503, 13644079, 15593902, 17769776, 19818716, 20037327, 71327550, 71333220, 72700706, 76071083], 962)
    [961, 22247451, 157350, 123332, 137349153, 5460554, 6914119, 17985087, 21871715, 22146520, 44144404, 57470146, 129631210, 171528, 20266850, 57422081, 72499223, 21338204, 23560202, 57418915, 57634601, 57937911, 58422532, 58609138, 58750500, 58828612, 59045931, 59049839, 59102850, 59367517, 59984341, 78060557, 85595863, 85602483, 139617572, 157621312, 158956564, 161115002, 163575618, 13644079, 15593902, 17769776, 19818716, 20037327, 71327550, 71333220]
    """

    url = generate_url(
        f"compound/fastidentity/cid/{query_cid}",
        "cids",
        "json",
        "identity_type=same_connectivity",
    )
    text = make_query(url)
    data = json.loads(text)

    same_connectivity_cids = set(
        data.get("IdentifierList", {}).get("CID", [])
    )

    filtered = [cid for cid in cids if cid not in same_connectivity_cids]

    return filtered


doctest.testmod()
